#wifi模块与MCU联调测试方案

	author: guohw@skyware.com.cn
	date  : 11/10/2014 1:42:58 PM
	ver   : 1.0
  
###一、测试方案：

1、wifi模块通过USB连接上电脑，设置好局域网wifi（可以通过手机客户端，也可以通过串口调试工具如secureCRT进行设置）

2、通过secureCRT对wifi模块进行串口连接，通过AT指令获取到wifi模块在局域网的ip地址。

3、通过电脑TCP/UDP调试工具，连接wifi模块：tcp连接，内网ip地址，8899端口。

4、通过TCP工具依照协议发送16进制的指令，此时可以通过secureCRT查看日志输出，具体的请参考下文中的例子。


###二、常用的wifi模块AT指令：

1、进入命令模式

	连续输入"+++"，wifi模块返回"a"，快速输入"a"，wifi模块进入命令模式。
	
2、查看局域网IP，设置在SOCKA

	AT+WANN

3、查看和设置server端的IP和端口	 

	AT+SOCKB =TCP,9999,182.92.148.183
	
4、开启调试模式：便于查看日志

	AT+NDBGL=10 关闭为 AT+NDBGL=0
	
5、查看WiFi模块版本号

	AT+VER
	
6、查看帮助指令集

	AT+H
	
7、查看固件版本

    AT+VER
###三、TCP客户端例子

登录指令，mac地址为设备唯一标识，如果平台上由此设备，直接登录上线，如果平台上无此设备，添加此设备。

	注意:不要有多余的空格

    {"sn":1020,"cmd": "login","mac": "AABBCCDDEEFF","pv": "1.0",
	"hfver": "","data": ["vid::12345","pid::12345","pkey::12345",
	"usrver::<string>"]}

    7B 22 73 6E 22 3A 31 30 32 30 2C 22 63 6D 64 22 3A 20 22 6C 6F 67 69 6E 22 
	2C 22 6D 61 63 22 3A 20 22 41 41 42 42 43 43 44 44 45 45 46 46 22 2C 22 70 
	76 22 3A 20 22 31 2E 30 22 2C 22 68 66 76 65 72 22 3A 20 22 22 2C 22 64 61 
	74 61 22 3A 20 5B 22 76 69 64 3A 3A 31 32 33 34 35 22 2C 22 70 69 64 3A 3A 
	31 32 33 34 35 22 2C 22 70 6B 65 79 3A 3A 31 32 33 34 35 22 2C 22 75 73 72 
	76 65 72 3A 3A 31 31 31 22 5D 7D 0A


在TCP客户端命令输入框中输入如下16进制的指令，即可在wifi模块打印的日志中看到wifi模块处理的流程。
	
	{"sn":38,"cmd":"download","data":["power::0"]} /n 关灯
	
	7b 22 73 6e 22 3a 33 38 2c 22 63 6d 64 22 3a 22 64 6f 77 6e 6c 6f 61 64 22 
	2c 22 64 61 74 61 22 3a 5b 22 70 6f 77 65 72 3a 3a 31 22 5d 7d 0a
	
	{"sn":38,"cmd":"download","data":["power::1"]} /n 开灯

	7b 22 73 6e 22 3a 33 38 2c 22 63 6d 64 22 3a 22 64 6f 77 6e 6c 6f 61 64 22 
	2c 22 64 61 74 61 22 3a 5b 22 70 6f 77 65 72 3a 3a 30 22 5d 7d 0a


下位机将data中的值 power 0 这一对更换为设备的指令即可。


### UDP 搜索工具
- udp ip地址 48899 端口，发送 HF-A11ASSISTHREAD 进行连接。


###四、串口发送数据

wifi模块会按照d口协议将mcu发过来的数据进行处理，转换成云平台识别的json格式，具体的请参考协议规范进行处理。

