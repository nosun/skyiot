## wifi模块固件测试

	version v1.0.5
	date	2015-03-17
	author  nosun

### 主要改动
- 过去分包的分隔符为 \0 在多键值对分隔，以及包结尾均使用，分包只能通过plen来进行，如果mcu法宝频繁，会造成wifi模块处理不过来，发包时粘包的情况，经过讨论，多键值对分隔符仍然使用\0，包的结束符使用\n表示，\n不计入长度计算。

### wifi固件升级
- 固件升级url：http://182.92.148.183/download/firmwire/LPBS2W_v1.0.5.bin
- 远程升级方法：wifi模块STA模式，连接到路由器，在电脑上用tcp工具通过局域网连接到wifi的ip地址，tcp方式，端口8899。在发送区发送如下代码：

hex 方式

7b 22 73 6e 22 3a 31 30 32 32 2c 22 63 6d 64 22 3a 22 75 70 64 61 74 65 77 69 66 69 22 2c 22 75 72 6c 22 3a 22 68 74 74 70 3a 2f 2f 31 38 32 2e 39 32 2e 31 34 38 2e 31 38 33 2f 64 6f 77 6e 6c 6f 61 64 2f 66 69 72 6d 77 69 72 65 2f 4c 50 42 53 32 57 5f 76 31 2e 30 2e 35 2e 62 69 6e 22 7d 0a

ascii方式

{"sn":1022,"cmd":"updatewifi","url":"http://182.92.148.183/download/firmwire/LPBS2W_v1.0.5.bin"}

需要在结尾处，增加换行符，ctrl+enter。

升级成功的话，tcp工具的显示区会显示：

    {"sn":1022,"cmd":"updatewifi","ret":"200"}

### 0x01

App向wifi模块发出登录请求，wifi模块汇报给App mcu的信息，因此向Mcu下发查询mcu信息指令

	AA 00 01 01 0A 

Mcu向wifi上报登录信息
    
    "vid::1\0pid::rsd01\0pkey::12345\0dsn::0\0usrver::1\n"

	AA 00 2F 01 76 69 64 3a 3a 31 00 70 69 64 3a 3a 72 73 64 30 31 00 70 6b 65 79 
    3a 3a 31 32 33 34 35 00 64 73 6e 3a 3a 30 00 75 73 72 76 65 72 3a 3a 31 0a

### 0x02

App 下发命令 	{"data"["power::on"],"cmd":"download","sn":12}
	
	串口收到 AA 00 0A 02 70 6F 77 65 72 3A 3A 6F 6E 0A  plen 10 不包含结束符 0A

### 0x03

Mcu上报给wifi设备的状态信息
	
	power::00  包含命令号 一共10 个字符

	Hex 码 AA 00 0A 03 70 6F 77 65 72 3A 3A 6F 6E 0A


### 0x04
	略

### 0x05
	略

### 0x06

	查询设备的运行状态，Wifi下发 AA 00 01 06 0A
	Mcu回复 03指令，上报所有状态。 

### 粘包测试

	年报测试ok，10ms每次连续发，看没有粘包现象

