# 测试文档 #

----------

	powered by guohw@skyware.com.cn
	version 1.0

## 说明 ##

本文档提供云平台，安卓客户端的测试方案及用例，便于测试部门展开测试。

## 用户操作流程 （请参考协议文档，此部分略）##

1. 用户注册
2. 用户登录
3. 修改用户信息
4. 设置用户头像
5. 设置报警阈值
6. 忘记密码

## 核心功能流程##

### 1、添加一台新设备 ###
1. 点击添加一台新设备
2. 扫描设备条形码
3. 为设备设置wifi网络
4. 用tcp工具发如下指令，模拟设备easylink之后的注册操作，此时设备表中将会生成一条设备注册数据，包含设备id，设备mac，设备online的状态。

> {"sn":1020,"cmd":"login","mac":"ACCF23216434","pv":"1.0","hfver": "v1.0|v1.2","data":["vid::12345","pid::12345","pkey::12345","usrver::v1.0"]}

5. 设置设备信息，并点击绑定设备，设备的状态被update，并添加用户与设备的绑定关系

###2、删除该设备###

进入设备列表，解除绑定此设备，此时设备关系表dictionary表中的用户与设备对应关系行清空。

###3、再次添加该设备###

添加设备流程，扫描设备Sn号码，由于设备列表中已经有了device_sn，所以直接绑定，在数据库中增加一条设备与用户绑定关系的记录。

###4、添加第二台###

本过程与添加一台新设备的流程一致，需要把数据库中第一台设备的mac地址和sn号码改动一下，然后重复进行操作。

###5、给设备发送指令###

设备状态为未开机，点击开关按钮，让设备开机。

###6、设备反馈运行状态###

>{"sn": 1023,"mac":"ACCF23216434","cmd":"upload","data":["power::1"]}

设备状态列表详见 《协议文档》 

###7、设备反馈传感器状态###

>{"sn": 1023,"mac":"ACCF23216434","cmd":"upload","data":["temp::30"]}

设备状态列表详见 《协议文档》 

###8、设备心跳模拟###
用tcp测试工具模拟设备重复发如下指令，30000ms一次，云平台收到指令后回复一次，双方对网络通信状态进行确认。

>{"sn": 1021,"mac":"ACCF23216434","cmd": "heartbeat"}

###9、设备离线模拟###

tcp测试工具停止发心跳，持续120s，云平台在120s内未收到设备的任何心跳起，断开连接，同时设备的状态由online转为offline，并推送至客户端，APP转为离线状态

###10、设备上线模拟###

用tcp测试工具重新连接云平台，进行登录操作，云平台收到登录指令后，设备的状态由offline转为online，并推送至客户端，APP转为在线状态。

>{"sn":1020,"cmd":"login","mac":"ACCF23216434","pv":"1.0","hfver": "v1.0|v1.2","data":["vid::12345","pid::12345","pkey::12345","usrver::v1.0"]}


##串口调试##

###wifi模块设置###

1、设置wifi模块socketB为tcp client，并且设置server的ip和端口
AT+SOCKB=TCP,9999,182.92.148.183

2、开启调试模式
AT+NDBGL=10