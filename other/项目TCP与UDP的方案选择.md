##UDP与TCP的区别，以及方案的评估

####UDP协议的缺点

- UDP是无连接的，TCP是有连接的。
  
微信发命令的时候需要能找到设备，因此需要保持一条通道。由于UDP协议是无连接的，使用UDP协议需要通过编程来实现通道保持。具体来说包括保持心跳，服务器端动态保存UDP的ip和端口（因为ip地址会变化，而UDP的端口会随机分配）

- UDP不保证传输的可靠性，而TCP是传输可靠的。

使用场景需要保障用户发命令能被成功执行，因此需要保障传输的可靠性。

使用UDP协议有可能会丢包，为了保证不丢，需要通过编程在服务器端实现缓存功能，对每次来包进行缓存，发送给设备后需要与设备进行确认是否收到，如果没收到自动重传，如果传输成功则清除缓存。  

使用TCP协议则无需考虑，它的可靠的，稳定的，协议本身实现了丢包重传。

- UDP传输不保证包的顺序，而TCP是有序的。

如果用户连续下发了两个指令，两个指令是截然相反的，UDP的包有可能后发的先到，先发的后到，导致指令执行有误，保证包的序列需要通过server与client端配合开发实现。

TCP协议传输是保障序列的，无需考虑这一点。

####TCP协议的缺点

- TCP协议效率比UDP协议低  
为了保障传输的可靠性，TCP使用了许多机制保障这一点，因此在传输的效率上会比UDP低。

- TCP协议占用资源比UDP高
因为TCP协议需要维持连接，每个连接会占用一定的内存（100k左右）,UDP不会。

####该如何选择

- 目前物联网主要使用TCP长连接，因为其稳定，成熟，可靠性高，比如京东智能云，百度云推送以及物联网协议MQTT。
- TCP长连接消耗的资源主要是内存，目前一台设备可配置的内存很轻易就能到几十个G，维持几十万的长连接问题不大，如果用户量到百万，也可以通过集群的办法进行解决，百度推送的用户量已经上千万（百度的APP都内置了推送）。
- 因为涉及到反向控制操作，如果使用UDP，其实需要自己实现类似TCP协议的一些功能，UDP本来的优势会大大降低，实际上为了保持心跳，端口维持，实际上也需要消耗部分服务器资源。
- 因为都是指令，每次传输的数据量很小，传输的效率TCP和UDP差别不会太大，一般情况下感知不到。
- TCP协议可靠成熟，实现成本低，如果采用UDP协议实现，要考虑诸多因素，在协议层需要增加额外的工作。

####小结

综上所述，建议采用TCP协议进行实现，稳定，可靠，可控，开发维护成本低，对于该项目的使用用户量来说，单台设备已经能够保障，硬件成本可控。